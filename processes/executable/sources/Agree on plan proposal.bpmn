<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1hvqska" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.11.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.19.0">
  <bpmn:process id="Process_0v0kmjr" name="Agree on plan proposal" isExecutable="true" camunda:historyTimeToLive="100">
    <bpmn:startEvent id="Event_1gwy1d5">
      <bpmn:outgoing>Flow_0aunm31</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:exclusiveGateway id="Gateway_16fnosg" name="Is plan proposal approved by all needed workers?">
      <bpmn:incoming>Flow_0m5761g</bpmn:incoming>
      <bpmn:outgoing>Flow_09yx58w</bpmn:outgoing>
      <bpmn:outgoing>Flow_0v6q3ww</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sendTask id="Activity_0t97rdy" name="Send plan proposal approval notifications" camunda:type="external" camunda:topic="send-plan-proposal-approval-notifications">
      <bpmn:incoming>Flow_09yx58w</bpmn:incoming>
      <bpmn:outgoing>Flow_0z3endf</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:endEvent id="Event_05wdtec">
      <bpmn:incoming>Flow_0z3endf</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:inclusiveGateway id="Gateway_19e1xdt" name="Workers needed?">
      <bpmn:incoming>Flow_0aunm31</bpmn:incoming>
      <bpmn:outgoing>Flow_1d3x9fv</bpmn:outgoing>
      <bpmn:outgoing>Flow_1a38nz4</bpmn:outgoing>
      <bpmn:outgoing>Flow_1ah25qa</bpmn:outgoing>
    </bpmn:inclusiveGateway>
    <bpmn:inclusiveGateway id="Gateway_015o72i">
      <bpmn:incoming>Flow_1uhvnwr</bpmn:incoming>
      <bpmn:incoming>Flow_14ur6hi</bpmn:incoming>
      <bpmn:incoming>Flow_1v1o09h</bpmn:incoming>
      <bpmn:outgoing>Flow_0m5761g</bpmn:outgoing>
    </bpmn:inclusiveGateway>
    <bpmn:scriptTask id="Activity_018udsk" name="Formulate plan proposal" scriptFormat="javascript">
      <bpmn:incoming>Flow_1d3x9fv</bpmn:incoming>
      <bpmn:outgoing>Flow_0swlqaq</bpmn:outgoing>
      <bpmn:script></bpmn:script>
    </bpmn:scriptTask>
    <bpmn:endEvent id="Event_10dedq9" name="Plan proposal discarded">
      <bpmn:incoming>Flow_0v6q3ww</bpmn:incoming>
      <bpmn:escalationEventDefinition id="EscalationEventDefinition_0afkdh6" escalationRef="Escalation_0qgamdn" />
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0m5761g" sourceRef="Gateway_015o72i" targetRef="Gateway_16fnosg" />
    <bpmn:sequenceFlow id="Flow_09yx58w" name="Yes" sourceRef="Gateway_16fnosg" targetRef="Activity_0t97rdy">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="javascript">(!JSON.parse(execution.getVariable("activities")).plumber.isNeeded || JSON.parse(execution.getVariable("plumberPlanProposal")).status === "ACCEPTED") &amp;&amp; 
(!JSON.parse(execution.getVariable("activities")).electrician.isNeeded || JSON.parse(execution.getVariable("electricianPlanProposal")).status === "ACCEPTED") &amp;&amp; 
(!JSON.parse(execution.getVariable("activities")).constructor.isNeeded || JSON.parse(execution.getVariable("constructorPlanProposal")).status === "ACCEPTED")</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0v6q3ww" name="No" sourceRef="Gateway_16fnosg" targetRef="Event_10dedq9">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="javascript">!((!JSON.parse(execution.getVariable("activities")).plumber.isNeeded || JSON.parse(execution.getVariable("plumberPlanProposal")).status === "ACCEPTED") &amp;&amp; 
(!JSON.parse(execution.getVariable("activities")).electrician.isNeeded || JSON.parse(execution.getVariable("electricianPlanProposal")).status === "ACCEPTED") &amp;&amp; 
(!JSON.parse(execution.getVariable("activities")).constructor.isNeeded || JSON.parse(execution.getVariable("constructorPlanProposal")).status === "ACCEPTED"))</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0z3endf" sourceRef="Activity_0t97rdy" targetRef="Event_05wdtec" />
    <bpmn:sequenceFlow id="Flow_1d3x9fv" name="Plumbers" sourceRef="Gateway_19e1xdt" targetRef="Activity_018udsk">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="javascript">JSON.parse(execution.getVariable("activities")).plumber.isNeeded;</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1v1o09h" sourceRef="Activity_0bww10t" targetRef="Gateway_015o72i" />
    <bpmn:serviceTask id="Activity_0bww10t" name="Offer plan proposal" camunda:type="external" camunda:topic="offer-plan-proposal-plumber">
      <bpmn:incoming>Flow_0swlqaq</bpmn:incoming>
      <bpmn:outgoing>Flow_1v1o09h</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1a38nz4" name="Electricians" sourceRef="Gateway_19e1xdt" targetRef="Activity_0mx8kq4">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="javascript">JSON.parse(execution.getVariable("activities")).electrician.isNeeded;</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="Activity_13whhxj" name="Offer plan proposal" camunda:type="external" camunda:topic="offer-plan-proposal-electrician">
      <bpmn:incoming>Flow_1xp2x8w</bpmn:incoming>
      <bpmn:outgoing>Flow_14ur6hi</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_14ur6hi" sourceRef="Activity_13whhxj" targetRef="Gateway_015o72i" />
    <bpmn:serviceTask id="Activity_18cf6t5" name="Offer plan proposal" camunda:type="external" camunda:topic="offer-plan-proposal-constructor">
      <bpmn:incoming>Flow_0dvntcc</bpmn:incoming>
      <bpmn:outgoing>Flow_1uhvnwr</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1ah25qa" name="Constructors" sourceRef="Gateway_19e1xdt" targetRef="Activity_0h1wncl">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression" language="javascript">JSON.parse(execution.getVariable("activities")).constructor.isNeeded;</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1uhvnwr" sourceRef="Activity_18cf6t5" targetRef="Gateway_015o72i" />
    <bpmn:sequenceFlow id="Flow_0aunm31" sourceRef="Event_1gwy1d5" targetRef="Gateway_19e1xdt" />
    <bpmn:sequenceFlow id="Flow_0swlqaq" sourceRef="Activity_018udsk" targetRef="Activity_0bww10t" />
    <bpmn:scriptTask id="Activity_0mx8kq4" name="Formulate plan proposal" scriptFormat="javascript">
      <bpmn:incoming>Flow_1a38nz4</bpmn:incoming>
      <bpmn:outgoing>Flow_1xp2x8w</bpmn:outgoing>
      <bpmn:script></bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_1xp2x8w" sourceRef="Activity_0mx8kq4" targetRef="Activity_13whhxj" />
    <bpmn:scriptTask id="Activity_0h1wncl" name="Formulate plan proposal" scriptFormat="javascript">
      <bpmn:incoming>Flow_1ah25qa</bpmn:incoming>
      <bpmn:outgoing>Flow_0dvntcc</bpmn:outgoing>
      <bpmn:script>if(JSON.parse(execution.getVariable("constructorPlanProposal")) === null) {
  let items = JSON.parse(execution.getVariable("activities")).constructor.items;
  let date = new Date(JSON.parse(execution.getVariable("today")));

  let jobProposals = items.map(item =&gt; {
    date.setDate(date.getDate() +1);
    return {
      ...item,
      startDateTime: date.toJSON(),
      endDateTime: date.toJSON()
    };
  });
  execution.setVariable(
    "constructorPlanProposal",
    JSON.stringify({"jobProposals": jobProposals})
  );
}</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_0dvntcc" sourceRef="Activity_0h1wncl" targetRef="Activity_18cf6t5" />
  </bpmn:process>
  <bpmn:escalation id="Escalation_0qgamdn" name="Escalation_0qgamdn" escalationCode="Escalation_0qgamdn" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_0v0kmjr">
      <bpmndi:BPMNShape id="Event_1gwy1d5_di" bpmnElement="Event_1gwy1d5">
        <dc:Bounds x="179" y="262" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_16fnosg_di" bpmnElement="Gateway_16fnosg" isMarkerVisible="true">
        <dc:Bounds x="945" y="255" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="928" y="205" width="85" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0l0wakm_di" bpmnElement="Activity_0t97rdy">
        <dc:Bounds x="1107" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_05wdtec_di" bpmnElement="Event_05wdtec">
        <dc:Bounds x="1299" y="262" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0vxvmbf_di" bpmnElement="Gateway_19e1xdt">
        <dc:Bounds x="295" y="255" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="226" y="225" width="87" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0gso8w3_di" bpmnElement="Gateway_015o72i">
        <dc:Bounds x="805" y="255" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0uvt0pt_di" bpmnElement="Activity_018udsk">
        <dc:Bounds x="450" y="70" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_158p70b_di" bpmnElement="Event_10dedq9">
        <dc:Bounds x="952" y="422" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="936" y="465" width="68" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0tamp2y_di" bpmnElement="Activity_0bww10t">
        <dc:Bounds x="630" y="70" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1g0oaul_di" bpmnElement="Activity_13whhxj">
        <dc:Bounds x="630" y="240" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0z1ocjb_di" bpmnElement="Activity_18cf6t5">
        <dc:Bounds x="630" y="400" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0xn40k2" bpmnElement="Activity_0mx8kq4">
        <dc:Bounds x="450" y="240" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_02e4yi3" bpmnElement="Activity_0h1wncl">
        <dc:Bounds x="450" y="400" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0m5761g_di" bpmnElement="Flow_0m5761g">
        <di:waypoint x="855" y="280" />
        <di:waypoint x="945" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_09yx58w_di" bpmnElement="Flow_09yx58w">
        <di:waypoint x="995" y="280" />
        <di:waypoint x="1107" y="280" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1042" y="262" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0v6q3ww_di" bpmnElement="Flow_0v6q3ww">
        <di:waypoint x="970" y="305" />
        <di:waypoint x="970" y="422" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="978" y="361" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0z3endf_di" bpmnElement="Flow_0z3endf">
        <di:waypoint x="1207" y="280" />
        <di:waypoint x="1299" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1d3x9fv_di" bpmnElement="Flow_1d3x9fv">
        <di:waypoint x="320" y="255" />
        <di:waypoint x="320" y="110" />
        <di:waypoint x="450" y="110" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="310" y="93" width="47" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1v1o09h_di" bpmnElement="Flow_1v1o09h">
        <di:waypoint x="730" y="110" />
        <di:waypoint x="830" y="110" />
        <di:waypoint x="830" y="255" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1a38nz4_di" bpmnElement="Flow_1a38nz4">
        <di:waypoint x="345" y="280" />
        <di:waypoint x="450" y="280" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="345" y="262" width="57" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14ur6hi_di" bpmnElement="Flow_14ur6hi">
        <di:waypoint x="730" y="280" />
        <di:waypoint x="805" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ah25qa_di" bpmnElement="Flow_1ah25qa">
        <di:waypoint x="320" y="305" />
        <di:waypoint x="320" y="440" />
        <di:waypoint x="450" y="440" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="326" y="423" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1uhvnwr_di" bpmnElement="Flow_1uhvnwr">
        <di:waypoint x="730" y="440" />
        <di:waypoint x="830" y="440" />
        <di:waypoint x="830" y="305" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0aunm31_di" bpmnElement="Flow_0aunm31">
        <di:waypoint x="215" y="280" />
        <di:waypoint x="295" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0swlqaq_di" bpmnElement="Flow_0swlqaq">
        <di:waypoint x="550" y="110" />
        <di:waypoint x="630" y="110" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1xp2x8w_di" bpmnElement="Flow_1xp2x8w">
        <di:waypoint x="550" y="280" />
        <di:waypoint x="630" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dvntcc_di" bpmnElement="Flow_0dvntcc">
        <di:waypoint x="550" y="440" />
        <di:waypoint x="630" y="440" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
